{% extends "base.html" %}

{% block title %}Players List - SquashSync{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="page-header">
        <h1>{{ page_title }}</h1>
    </div>

    <form method="get" class="mb-4">
        <div class="row g-2">
            <div class="col-md-12">
                <input type="text" name="q" class="form-control" placeholder="Search by name..." value="{{ search_query|default_if_none:'' }}">
            </div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>School Group(s)</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="player-results-body">
                {% include "players/partials/player_list_results.html" %}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.querySelector('input[name="q"]');
        const resultsBody = document.getElementById('player-results-body');
        let debounceTimer;

        function fetchResults() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const query = searchInput.value;
                
                const url = new URL(window.location.href);
                url.searchParams.set('q', query);
                
                // Keep existing school_group param if valid, but we don't change it via UI anymore
                // Or just ignore it. Let's keep it simple and just set 'q'.
                // If the user lands on ?school_group=1, searching will keep it unless we explicitly remove it.
                // The previous code was rewriting the whole query params. 
                // Let's just update 'q'.
                
                fetch(url, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    resultsBody.innerHTML = html;
                })
                .catch(error => console.error('Error fetching players:', error));
            }, 300); // 300ms debounce
        }

        if (searchInput) {
            searchInput.addEventListener('input', fetchResults);
        }
    });
</script>
{% endblock %}