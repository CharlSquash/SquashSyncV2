{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block page_title %}{{ page_title|default:"Coaches" }} - SquashSync{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="page-header d-flex justify-content-between align-items-center">
        <h1><i class="bi bi-person-badge me-2"></i>{{ page_title|default:"Coaches" }}</h1>
        {% if request.user.is_superuser %}
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#inviteCoachModal">
                <i class="bi bi-send-plus-fill me-1"></i> Invite New Coach
            </button>
        {% endif %}
    </div>

    {% if coaches %}
        <div class="list-group coach-list">
            {% for coach in coaches %}
                <a href="{% url 'accounts:coach_profile' coach.id %}" class="list-group-item list-group-item-action">
                    <div class="coach-photo">
                        {% if coach.profile_photo %}
                            <img src="{{ coach.profile_photo.url }}" alt="Photo of {{ coach.user.get_full_name }}">
                        {% else %}
                            <img src="{% static 'images/default_avatar.png' %}" alt="Default avatar">
                        {% endif %}
                    </div>
                    <div class="coach-info">
                        <h5 class="mb-1">{{ coach.user.get_full_name|default:"Unnamed Coach" }}</h5>
                        <div class="coach-meta">
                            <i class="bi bi-envelope"></i> {{ coach.user.email|default:"N/A" }}
                        </div>
                    </div>
                    <span class="action-icon">
                        <i class="bi bi-chevron-right"></i>
                    </span>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert no-coaches-alert mt-3" role="alert">
            No active coaches found.
        </div>
    {% endif %}
</div>

<!-- Invitation Modal -->
<div class="modal fade" id="inviteCoachModal" tabindex="-1" aria-labelledby="inviteCoachModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="inviteCoachModalLabel">Invite a New Coach</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Enter the email address of the coach you would like to invite. They will receive an email with a link to create their account.</p>
          {{ invitation_form|crispy }}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Send Invitation</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
